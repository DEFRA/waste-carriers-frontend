<%= render 'shared/content_for_pages' %>

<main id="content" role="main" class="group">
  <article role="article" class="group">
    <section>
      <div class="inner">
        <div class="col-1">

          <!-- WF 4.3.2 -->
          <div id="page7"  data-journey="waste-carriers-registration:key-person-details">

            <% content_for :page_title, createTitle('.title') %>
            <ol>
               <li class="back_link"><%= render 'back_link' %></li>
               <li class="step"><%= t '.step' %></li>
            </ol>

            <%= render 'errors' %>

            <% legend = t '.legend' %>
            <!-- A blank button_label denotes a scenario where we only
              expect to collect one entry -->
            <% button_label = nil %>

            <%= form_for(@key_person, url: {action: "create"} ) do |f| %>

              <% case @registration.businessType %>
                <% when 'limitedCompany' %>
                  <% legend = t '.legend_limited' %>
                  <% button_label = t '.button_label_limited' %>
                <% when 'partnership' %>
                  <% legend = t '.legend_partner' %>
                  <% button_label = t '.button_label_partner' %>
                <% when 'publicBody' %>
                  <% legend = t '.legend_public' %>
                  <% button_label = t '.button_label_public' %>
              <% end %>

              <%= render 'form', f: f, d: @key_person, legend: legend %>
              <% unless button_label.blank? %>
                <span class="next_link">
                  <input name="add" class="button button-get-started" type="submit" value="<%= button_label %>"/>
                </span>
              <% end %>
            <% end %>

            <!-- If button_label is blank just show the next button else show the list biut only show the
              next button if at least one person has been added -->
            <% if button_label.blank? %>
              <%= form_for(@registration, :url => { :action => 'done' }, :method => 'get'  ) do |f| %>
                <div class="next_link"><%= render 'next_link' %></div>
              <% end %>
            <% else %>
              <% if @key_people.any? %>
                <%= render 'key_people_index' %>
                <%= form_for(@registration, :url => { :action => 'done' }, :method => 'get'  ) do |f| %>
                  <div class="next_link"><%= render 'next_link' %></div>
                <% end %>
              <% end %>
            <% end %>

          </div>

        </div>
      </div>
    </section>
  </article>
</main>