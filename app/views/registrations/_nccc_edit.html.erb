
<%= render "errors" %>

<% if params[:note] %>
<div id="note_explanation" class="note-summary">
  <h1><%= params[:note]%></h1>
</div>
<% end %>

<!-- WF 4.3.1 -->
<div id="page1"  data-journey="waste-carriers-registration:edit">

<fieldset>
<legend><%= t 'registrations.business_step.business_or_org_details' %></legend>

<div class="form-group<%if @registration.errors[:businessType].any?%> validation<%end%>">
	<%= validation_for(@registration, :businessType) %>
	<%= f.label :businessType, class: 'form-label' %>
	<%= f.select :businessType, options_for_select(Registration.business_type_options_for_select,f.object.businessType) %>
</div>
<div class="form-group<%if @registration.errors[:companyName].any?%> validation<%end%>">
	<%= validation_for(@registration, :companyName) %>
	<%= f.label :companyName, class: 'form-label' %>
	<%= f.text_field :companyName%>
</div>

</fieldset>

</div>

<!-- WF 4.3.2 -->
<div id="page2">

<%= render "address_entry",:f=>f %>


<fieldset>
<legend><%= t 'registrations.contact_step.contact_information_legend' %></legend>
<div class="form-group<%if @registration.errors[:firstName].any?%> validation<%end%>">
	<%= validation_for(@registration, :firstName) %>
    <%= f.label :firstName, class: 'form-label' %>
    <%= f.text_field :firstName %>
</div>
<div class="form-group<%if @registration.errors[:lastName].any?%> validation<%end%>">
	<%= validation_for(@registration, :lastName) %>
    <%= f.label :lastName, class: 'form-label' %>
    <%= f.text_field :lastName %>
</div>
<div class="form-group<%if @registration.errors[:phoneNumber].any?%> validation<%end%>">
	<%= validation_for(@registration, :phoneNumber) %>
    <%= f.label :phoneNumber, class: 'form-label' %>
    <%= f.telephone_field :phoneNumber %>
</div>
<div class="form-group<%if @registration.errors[:contactEmail].any?%> validation<%end%>">
	<%= validation_for(@registration, :contactEmail) %>
    <%= f.label :contactEmail, class: 'form-label' %>
    <%= f.email_field :contactEmail%>
</div>

<% if agency_user_signed_in? %>
<!-- // START -->
<%= f.fields_for :metaData.first do |ff| %>
<p id="revoke_question" class="group">
  <label for="revoke_question"><%= t('.revokedQuestion') %></label>
  <span class="inline">
    <input class="radio" id="revoke_question_yes" name="revoke_question" type="radio" value="yes"
    	<% if @registration.metaData.first.revokedReason != '' && !@registration.metaData.first.revokedReason.nil? || @registration.errors[:revokedReason].any? %>checked="true"<%end%> <% if @registration.metaData.status == "REVOKED" %>disabled="true"<%end%>>
    <label class="label" for="revoke_question_yes">Yes</label>
    <input class="radio" id="revoke_question_no" name="revoke_question" type="radio" value="no"
    	<% if !((@registration.metaData.first.revokedReason != '' && !@registration.metaData.first.revokedReason.nil?) || @registration.errors[:revokedReason].any?) %>checked="true"<%end%> <% if @registration.metaData.status == "REVOKED" %>disabled="true"<%end%>>
    <label class="label" for="revoke_question_no">No</label>
  </span>
</p>
<p class="group <%if @registration.errors[:revokedReason].any?%> validation<%end%>">
  <%= validation_for(@registration, :revokedReason) %>
  <%= ff.label :revokedReason, t('.revokedReason') %>
  <span>This will appear as the reason sent in the email to the registrant</span>
  <% if @registration.metaData.first.status == "REVOKED" %>
    <%= ff.text_area :revokedReason, :value => @registration.metaData.first.revokedReason, :disabled=>'disabled' %>
  <% else %>
    <%# Comment: For some reason the revokedReason field cannot detect it's own value on page render, as such the value is retrieved and set manually in this field. %>
  	<%= ff.text_area :revokedReason, :value => @registration.metaData.first.revokedReason %>
  <% end %>
</p>
<% end %>

<!-- // END -->
<% end %>

<p class="group">
	<i><%= t '.registeredOn',:date=>format_date(@registration.metaData.first.dateRegistered) %></i>
</p>
</fieldset>

</div>
<p class="action group">
<% if agency_user_signed_in? %>
  <%= link_to t('registrations.form.back_button_label'), registrations_path, :class => 'button-secondary' %>
<% else logger.debug 'User not signed in so Redirect back to my account page' %>
  <%= link_to t('registrations.form.back_button_label'), userRegistrations_path(current_user.id), :class => 'button-secondary' %>
<% end %>
<input name="reprint" class="button-secondary" type="submit" value="<%= t 'registrations.form.print_button_label' %>"/>
<% if @registration.metaData.first.status != "REVOKED" %>
<input name="next" class="button" type="submit" value="<%= t 'registrations.form.update_button_label' %>"/>
<% if agency_user_signed_in? %>
<input id="delete" name="revoke" class="button" type="submit" value="<%= t 'registrations.form.revoke_button_label' %>"/>
<% end %>
<% else %>
<input name="unrevoke" class="button" type="submit" value="<%= t 'registrations.form.unrevoke_button_label' %>"/>
<% end %>
</p>
