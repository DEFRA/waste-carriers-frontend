<%= render 'shared/content_for_pages' %>
<% content_for :page_title, createTitle('registrations.form.agency_search_label') %>
<main id="content" role="main" class="group">
<article role="article" class="group">

<% if params[:error] %>
<div id="error_explanation" class="validation-summary">
  <h2><%= params[:error]%></h2>
</div>
<% end %>

<% if !notice.nil? %>
<div id="note_explanation" class="note-summary">
  <h2><%= notice%></h2>
</div>
<% end %>


<% if params[:note] %>
<div id="note_explanation" class="note-summary">
  <h2><%= params[:note]%></h2>
</div>
<% end %>


<fieldset id='find-registration'>
	<legend><%= t 'registrations.form.agency_search_label' %></legend>
	<%= render "shared/meta_phases"%><!-- what is this rendering? -->
	<form method="get" action="/registrations">

	<div class="form-group"  data-journey="waste-carriers-registration:registrations">
    	<label for="q", class: 'form-label' >Find a registration</label>
		<input id="q" name="q" type="text" value="<%= params[:q]%>" />
	</div>

<div id="advanced-options" style="<% if params[:searchWithin]=='any'||!params[:searchWithin] %>display:none<% end %>">

	<div class="form-group">
	<label for="searchWithin", class: 'form-label'>Search only within</label>
		<select id="searchWithin" name="searchWithin">
			<option value="any"<% if params[:searchWithin]=='any'||!params[:searchWithin] %>selected="selected"<%end%>>Any</option>
			<option value="companyName" <% if params[:searchWithin]=='companyName' %>selected="selected"<%end%>>Company Name</option>
			<option value="contactName" <% if params[:searchWithin]=='contactName' %>selected="selected"<%end%>>Contact Name</option>
			<option value="postcode" <% if params[:searchWithin]=='postcode' %>selected="selected"<%end%>>Postcode</option>
		</select>
	</div>
</div>

<div class='inline'>
<div class="form-group">
	<input type="submit" id="reg-search" class="button" value="Search" />
	<a href="#" id="toggle-search"><% if params[:searchWithin]=='any'||!params[:searchWithin] %>Refine<% else %>Full<% end %> search</a>
</div>
</div>


<div class='form-group'>
	<input name="agency" type="submit" class="button" value="New registration" />
	<% if params[:q]%>
	<div id="reg-search-result" style="">
		<h2>Found <%=pluralize(@registrations.count,"registration")%></h2>
		<p>Showing 1-<%= @registrations.count %>  of <%=pluralize(@registrations.count,"record")%></p>
		<% @registrations.each do |registration| %>
	</div>
</div>

<div class="box <%= registration.boxClassSuffix %>">
	<dl>
		<dt>Name</dt>
		<dd><%= registration.companyName %></dd>

		<dt>Postcode</dt>
		<dd><%= registration.postcode %></dd>
	</dl>
	<div class="detailsBoxWrapper">
		<div class="detailsBox <%= registration.boxClassSuffix %>">
			<% if registration.metaData.status == "REVOKED" %>
			<div class="detailHeading">Registration Status: Revoked</div><% end %>
				<% if registration.metaData.status == "PENDING" %>
			<div class="detailHeading">Registration Status: Pending</div><% end %>
				<div class="detail">
					<div class="data"
						data-organisationType="<%= registration.businessType%>"
						data-organisationName="<%=registration.companyName%>"
						data-individualsType="<%=registration.individualsType%>"
						data-publicBodyType="<%=registration.publicBodyType%>"
						data-firstName="<%=registration.firstName%>"
						data-lastName="<%=registration.lastName%>"
						data-phoneNumber="<%=registration.phoneNumber%>"
						data-emailAddress="<%=registration.contactEmail%>"
						data-houseNumber="<%=registration.houseNumber%>"
						data-postcode="<%=registration.postcode%>"
						data-uprn="<%=registration.uprn%>"
						data-address="<%=registration.address%>"
						data-status="<%=registration.metaData.status%>"
						data-regIdentifier="<%=registration.regIdentifier%>"
						data-accessCode="<%=registration.accessCode%>">
					</div>
				</div>

			<form action="<%=ncccedit_url(registration.id)%>">
				<input type="submit" class="button" value="Edit registration"/>
			</form>

			<form action="<%=paymentstatus_url(registration.id)%>">
				<input type="submit" class="button" value="Payment Status"/>
			</form>

			<%# button_to "Delete", registration_path(registration.id), :method => :delete, :class => "button", :data => "{ :confirm => 'are you sure?' }"%>
		</div>
	</div>
</div>



<% end %>
<% end %>

<div class='related-positioning'>
	<div class='related-container'>
		<div class='related'>
			<div class='inner group related-subsection'>
			<%= render "shared/current_user" %>
			</div>
		</div>
	</div>
</div>

</form>
</fieldset>

</article></main>
