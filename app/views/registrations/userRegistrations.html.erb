<%= render 'shared/content_for_pages' %>
<%#= render "shared/current_user" %>

<% content_for :page_title, createTitle('.subtitle') %>

<div id="wrapper">

<main id="content" role="main" class="group">

<div class="back-section">
    <ol>
      <li></li>
    </ol>
</div>

<header class="page-header group">
  <div class="hgroup">

  <% if params[:note] %>
  <div id="note_explanation" class="note-summary">
    <h1 class="heading-large"><%= params[:note]%></h1>
  </div>
  <% end %>

  <% if notice %>
  <div id="notice_explanation" class="note-summary">
    <h2 class="heading-large"><%= notice %></h2>
  </div>
  <% end %>

  </div>
</header>

<div class="grid-wrapper">

<div class="grid-2-3">
  <div class="inner-block">

  <fieldset>
    <legend></legend>

    <!--<h1><%= t 'registrations.form.title' %></h1>-->
    <!--<h1 class="subtitle"><%= t '.subtitle' %></h1>-->
    <h2 class="heading-medium"><%= t '.subtitle' %></h2>
    <%= render "shared/meta_phases"%>

    <p class="group"><%= t '.summaryText' %></p><!-- FIXME: Force indent as to not wrap over user status box -->

    <p class="group"><strong><%= t '.registrationCountText', :count => pluralize(@registrations.count,"registration") %></strong></p>

    <div class='summary-box'>
      <table summary=" A list of the user's registrations">
        <thead>
          <tr>
            <th><%= t '.name_header' %></th>
            <th><%= t '.postcode_header' %></th>
            <th><%= t '.registration_header' %></th>
            <th><%= t '.status_header' %></th>
            <th><%= t '.expiry_header' %></th>
            <th></th>  <!--  empty column -->
            <th></th> <!--  column for certificate button -->
            <th></th> <!--  column for edit button -->
            <th></th> <!--  column for delete registration -->
            <th></th> <!--  column for renew button -->
            <th></th> <!--  column for more copy cards -->
          </tr>
        </thead>
        <tbody>
	        <% @registrations.each do |registration| %>
	            <td><%= registration.companyName %></td>
	            <td><%= registration.postcode %></td>
	            <td><%= registration.regIdentifier %></td>
	            <td><%=  registration.metaData.first.status %></td>
	            <td>
		            <% case  registration.metaData.first.status %>
		            <% when 'ACTIVE', 'EXPIRED'  %>
			            <%= registration.expires_on.strftime("%d-%^B-%Y") %>
		            <% when 'REVOKED' %>
			            <%= t '.status_revoked_text' %>
		            <% else %>
			            <%= t '.status_na_text' %>
		            <% end %>
	            </td>
	            <td></td>

              <td>
              <% if registration.can_view_certificate? %>
                <%= link_to 'View Certificate', print_path(registration.uuid) %>
              <% end %>
              </td>

              <td>
              <% if registration.can_be_edited? %>
                <%= link_to 'Edit Registration', edit_path(registration.uuid, edit_process: RegistrationsController::EditMode::EDIT) %>
              <% end %>
              </td>

		          <td><%= link_to t('registrations.form.delete_button_label'), confirmDelete_path(registration.uuid), :method => :get, :id => "delete" if registration.metaData.first.status == 'ACTIVE' %></td>

	            <td>
		            <% if registration.about_to_expire? %>
	            	<%= link_to 'Renew Registration', edit_path(registration.uuid, edit_process: RegistrationsController::EditMode::RENEWAL) %>
	            	<% elsif registration.can_be_recreated? %>
		            	<%= link_to 'Re-create Registration', edit_path(registration.uuid, edit_process: RegistrationsController::EditMode::RECREATE) %>
	            	<% end %>
	            </td>

	            <td><%= link_to t('.addCopyCards'), newOrderCopyCards_path(registration.uuid) if registration.can_request_copy_cards?  %></td>

	          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</fieldset>

</div><!-- end inner-block -->
</div><!-- end grid-2-3 -->

<form method="get" action="<%= find_path %>" class="action group">
	<input type="submit" class="button" value="<%= t 'registrations.form.new_button_label' %>" />
</form>

  <div class="grid-1-3">
    <div class="inner-block related">
      <div class="inner group related-subsection">
        <h2 class="heading-small">Current user</h2>
          <nav aria-labelledby="parent-subsection" role="navigation">
            <ul>
              <li><%= render "shared/current_user" %></li>
            </ul>
          </nav>
        </div>
      </div>
    </div><!-- end grid 1-3-->

    </div><!-- end grid-wrapper -->

  </main><!-- end main -->
</div><!-- end wrapper -->
